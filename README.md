# 🐾 SaiPet

SillyTavern 채팅 옆에서 함께하는 AI 반응형 가상 펫 확장프로그램입니다.  
채팅을 관전하며 독자적인 감정 반응과 대사를 보여주고, 직접 말도 걸 수 있습니다.

---

## ✨ 주요 기능

### 🎨 펫 외형 (12가지 상태)
- **상태별 커스텀 이미지**: idle, happy, sad, excited, surprised, nervous, confident, shy, sleeping, thinking, angry, dragging
- **워킹 스프라이트**: 걷기 전용 이미지 별도 설정 (파일 업로드 / URL 입력)
- **GIF 지원**: 움직이는 이미지 사용 가능
- **크기 조절** / **좌우 반전**
- 이미지 미설정 시 기본 이모지 표시

### 🤖 AI 반응 시스템
- **관전자 모드**: 유저와 AI 캐릭터의 대화를 제3자 시점에서 관전하고 코멘트
- **캐릭터 모드 (속마음)**: 채팅 캐릭터의 진짜 속마음을 독백으로 표현
- **직접 말걸기 (💬)**: 펫에게 직접 대화를 걸면 성격에 맞게 응답
- **기분 자동 추론**: AI 응답에서 mood 태그를 파싱해 표정 자동 전환
- **generateRaw 사용**: ST 시스템 프롬프트 오염 없이 깨끗한 응답 생성
- **검열 방지 프리앰블**: 모든 프롬프트에 자동 적용
- **월드인포(로어북) 포함 옵션**
- **Connection Manager 지원**: 별도 API 프로필로 펫 전용 API 사용 가능
- **채팅 히스토리 참조**: 최근 N개 메시지를 읽고 반응 (1~20개 설정)

### 🗣️ 자발적 말걸기 (Spontaneous Speech)
- **AI 자발적 대화**: 펫이 스스로 시간/배고픔/대기 상황을 인지하고 먼저 말을 걸어옴
- **상황 인식 프롬프트**: 현재 시간대, 배고픔 상태, 대기 시간에 따라 다른 반응 생성
- **혼잣말/관심끌기/시간 코멘트/배고픔 불평** 등 다양한 발화 유형
- **설정 가능 간격**: 최소/최대 간격 (분) 슬라이더로 조절
- **잠자기 중 자동 차단**: sleeping 상태에서는 자발적 말걸기 발동 안 됨
- zzZ 이펙트 제거 후 자연스럽게 깨어남

### 💬 말풍선
- **6종 디자인 테마**: 심플 / 귀여운 / 클래식 / 사이버펑크 / 레트로 / 오리엔탈
- **폰트 선택**: 12종 한글 폰트 (ST-Customizer 호환)
- **액센트 컬러**: 테마 포인트 색상 커스텀
- **배경색 / 글자색 커스텀** (꼬리 색상 자동 동기화)
- **최대 너비 슬라이더**: 말풍선 최대 너비 조절
- **표시 시간 설정**
- **화면 밖 잘림 방지**: 펫 위치에 따라 말풍선 자동 보정, 꼬리는 항상 펫 중앙을 가리킴

### 📝 커스텀 대사 (12가지 상황)
- idle, sleeping, dragging, click, clickSpam, greeting, latenight, morning, longAbsence, feeding, hungry, petting
- 각 상황별 여러 대사 등록 가능
- 미설정 시 기본 대사 (츠데레 메이드 미유) 사용

### 🍖 컨디션 시스템
- **배고픔 게이지**: 5분마다 자동 감소, 밥주기(🍖) 버튼으로 회복
- **배고픔 알림**: 30% 이하 시 자동 대사 트리거
- **오프라인 계산**: 접속 안 한 동안의 감소량도 반영
- **3단계 배고픔 패널티**:
  - 🟡 **≤30% (배고픔)**: idle/sleeping 대사가 배고픔 대사로 오버라이드
  - 🔴 **≤10% (극심한 배고픔)**: 클릭/쓰다듬기 50% 확률로 무시

### 🚶 걷기 시스템
- **자동 걷기**: 펫이 좌우로 자연스럽게 뒤뚱뒤뚱 걸어다님
- **이동 범위**: 원래 위치 기준 ±120px
- **이동 간격**: 30초~90초 랜덤
- **뒤뚱 애니메이션**: CSS waddle 키프레임으로 귀여운 걸음걸이
- **워킹 스프라이트**: 걷기 전용 이미지 지원 (기본 walking.png 포함)
- **자동 일시정지**: 잠자기/드래그 중 걷기 자동 중단, 끝나면 재개
- 드래그 후 새 원점 자동 설정

### 💕 상호작용 이펙트
- **쓰다듬기 (길게 누르기)**: 하트 파티클 ❤️💕💖
- **연속 클릭 (5회+)**: 짜증 반응
- **졸기 이펙트**: sleeping 상태에서 `z z Z` 떠오름
- **바운스 / 흔들림 애니메이션**

### ⚡ 반응 트리거
- 유저 메시지 전송 / AI 응답 완료 / 대기 시간 초과
- **2단계 대기**: 4분 → idle 대사, 10분 → sleeping 전환 + zzZ
- 채팅방 진입 시 시간대별 인사 (심야/아침/일반)
- 1시간+ 오래 비움 시 특별 인사
- 드래그 중 전용 반응

### 💾 프리셋 시스템
- 저장 / 불러오기 / 덮어쓰기 / 삭제
- JSON 내보내기/가져오기 (프리셋 공유)
- 개인정보 자동 제거 (ownerName, ownerPersona)
- 걷기/자발적 말걸기 설정 포함

### 📊 대화 로그
- **직접 대화 로그**: 말걸기 → 펫 응답 (펫별 분리)
- **채팅 반응 로그**: AI 응답에 대한 펫 반응 (채팅방별 분리)
- **자발적 말걸기 로그**: 트리거 라벨 `자발적 말걸기`로 기록
- 로그 뷰어 (탭 전환) / JSON 내보내기 / 자동 새로고침

### 📱 모바일 대응
- 모바일 기기 감지 시 펫 자동 비활성화
- 태블릿 감지 지원
- 터치 드래그 / 탭 / 길게 누르기 지원

---

## 📦 설치

1. SillyTavern의 `extensions/third-party/` 폴더에 `SaiPet` 폴더 복사
2. SillyTavern 재시작 또는 새로고침
3. 확장프로그램 설정에서 **🐾 SaiPet** 찾기

> 폴더명 대소문자는 구분하지 않습니다 (`SaiPet`, `saipet`, `SAIPET` 모두 가능)

---

## 🎮 사용법

### 기본
1. 설정에서 **활성화** 토글 ON
2. 채팅하면서 펫 반응 즐기기!

### AI 반응
1. **AI 반응 사용** 토글 ON
2. 펫 이름 설정
3. (선택) 커스텀 성격 프롬프트 작성
4. (선택) 반응 모드: 관전자 / 캐릭터(속마음)
5. (선택) Connection Manager 프로필 연결

### 자발적 말걸기
1. **자발적 말걸기** 토글 ON
2. 최소/최대 간격 설정 (기본 15분/30분)
3. 펫이 알아서 상황에 맞는 말을 걸어옴

### 걷기
1. **걷기** 토글 ON (기본 활성)
2. (선택) 워킹 스프라이트 업로드 또는 URL 입력
3. 미설정 시 기본 walking.png 사용

### 말풍선 꾸미기
1. **디자인** 드롭다운에서 6종 테마 선택
2. (선택) 폰트, 액센트 컬러, 배경색/글자색 커스텀
3. (선택) 최대 너비 슬라이더 조절

### 프리셋 공유
1. **내보내기**: 프리셋 선택 → 📤 내보내기 → JSON 다운로드
2. **가져오기**: 📥 가져오기 → JSON 선택 → 자동 등록

---

## 😺 상태 목록

| 상태 | 설명 | 기본 이모지 |
|------|------|-------------|
| idle | 평상시 | 😺 |
| happy | 기쁨 | 😸 |
| sad | 슬픔 | 😿 |
| excited | 흥분 | 🙀 |
| surprised | 놀람 | 🙀 |
| nervous | 긴장 | 😾 |
| confident | 자신감 | 😼 |
| shy | 수줍음 | 🙈 |
| sleeping | 잠자기 | 😴 |
| thinking | 생각중 | 🐱 |
| angry | 화남 | 😾 |
| dragging | 드래그 | 😼 |

---

## 🎨 말풍선 디자인

| 디자인 | 설명 |
|--------|------|
| simple | 깔끔한 기본 스타일 |
| cute | 둥글둥글 귀여운 스타일 |
| classic | 전통적인 만화 말풍선 |
| cyberpunk | 네온/글리치 사이버펑크 |
| retro | 도트/픽셀 레트로 게임풍 |
| oriental | 동양풍 수묵/한지 스타일 |

---

## 🔧 기술 스택

- Vanilla JavaScript (ES Modules)
- CSS3 Animations & CSS Variables
- FontAwesome Icons
- SillyTavern Extension API (`generateRaw`, `eventSource`, `getContext`)
- Connection Manager API (선택)

---

## 📝 버전 기록

### v1.1.0
- 🚶 걷기 시스템 (뒤뚱 애니메이션, 워킹 스프라이트, 자동 일시정지)
- 🗣️ 자발적 말걸기 (상황 인식 AI 자발적 대화, 설정 가능 간격)
- 🍖 3단계 배고픔 패널티 (대사 오버라이드, 상호작용 무시)
- 🎨 6종 말풍선 디자인 테마 (심플/귀여운/클래식/사이버펑크/레트로/오리엔탈)
- 🔤 12종 한글 폰트 선택 (ST-Customizer 호환)
- 🎨 액센트 컬러 / 최대 너비 슬라이더 추가
- ⏱️ 2단계 대기 시스템 (4분 idle → 10분 sleeping)
- 📱 태블릿 감지 지원
- 🔧 FontAwesome 아이콘 적용
- 🐛 다수 버그 수정 및 안정성 개선

### v1.0.0
- 최초 릴리즈
- 12상태 스프라이트 + 커스텀 이미지 + GIF
- AI 반응 (관전자/캐릭터 모드) + generateRaw + 검열 방지
- 직접 말걸기 (💬) + 대화 로그
- 컨디션 시스템 (배고픔 + 밥주기)
- 프리셋 저장/공유/가져오기
- 쓰다듬기 하트 + 졸기 zzZ 이펙트
- 말풍선 화면 밖 잘림 방지
- 모바일 자동 비활성화

---
